<h1 class="mt-4">User Management</h1>

<form class="form-inline mb-4" action="/users" method="GET">
    <input type="text" name="q" class="form-control mr-2" placeholder="Search..." value="<%= query %>">
    <select name="by" class="form-control mr-2">
        <option value="sAMAccountName" <%=searchBy==='sAMAccountName' ? 'selected' : '' %>>Username</option>
        <option value="mail" <%=searchBy==='mail' ? 'selected' : '' %>>Email</option>
        <option value="employeeNumber" <%=searchBy==='employeeNumber' ? 'selected' : '' %>>Employee ID</option>
        <option value="name" <%=searchBy==='name' ? 'selected' : '' %>>Name</option>
        <option value="sn" <%=searchBy==='sn' ? 'selected' : '' %>>Surname</option>
    </select>
    <button type="submit" class="btn btn-primary">Search</button>
</form>

<% if (typeof success !=='undefined' && success) { %>
    <div class="alert alert-success">User updated successfully</div>
    <% } %>

        <% if (typeof error !=='undefined' && error) { %>
            <div class="alert alert-danger">
                <%= error %>
            </div>
            <% } %>

                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Pwd Last Set</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% users.forEach(user=> { %>
                            <tr>
                                <td>
                                    <%= user.sAMAccountName %>
                                </td>
                                <td>
                                    <%= user.name || user.cn %>
                                </td>
                                <td>
                                    <%= user.mail || user.userPrincipalName %>
                                </td>
                                <td>
                                    <%= user.pwdLastSet %>
                                </td> <!-- TODO: Format Date -->
                                <td>
                                    <%= user.userAccountControl %>
                                </td> <!-- TODO: Decode Status -->
                                <td>
                                    <a href="/users/<%= user.sAMAccountName %>/edit"
                                        class="btn btn-sm btn-info">Edit</a>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>